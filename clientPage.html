<!DOCTYPE html>
<html>
    <head>
        <title>
            Select Room Preferences
        </title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.4.0/nouislider.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.4.0/nouislider.min.js"></script>
    </head>
    <body>
        <form>
            <!--
            <label for="username">Username</label>
            <input type="text" id="username" name="username" required><br><br>
            -->

            <label for="type">Room Type</label>
            <select id="type" name="type">
                <option value="Single">Single</option>
                <option value="Double">Double</option>
                <option value="Twin">Twin</option>
                <option value="Suite">Suite</option>
            </select><br><br>

            <label for="beds">Number of Beds</label>
            <select id="beds" name="beds">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
            </select><br><br>

            <label for="bedSize">Bed Size</label>
            <select id="bedSize" name="bedSize">
                <option value="1.0">1</option>
                <option value="1.5">1.5</option>
                <option value="2.0">2</option>
            </select><br><br>

            <label for="balcony">Balcony</label>
            <input type="checkbox" id="balcony" name="balcony"><br><br>

            <label for="view">View</label>
            <select id="view" name="view">
                <option value="City View">City View</option>
                <option value="Garden View">Garden View</option>
                <option value="Sea View">Sea View</option>
            </select><br><br>

            <label for="accessibility">Accessibility Access</label>
            <input type="checkbox" id="accessibility" name="accessibility"><br><br>

            <label for="startdate">Start Date</label>
            <input type="date" id="startdate" name="startdate" required><br><br>

            <label for="enddate">End Date</label>
            <input type="date" id="enddate" name="enddate" required><br><br>

            <label for="price">Price</label>
            <input type="number" id="price" name="price" min="0" max="1000" required>

            <input type="submit" value="Submit">
        </form>

        <script>
            var url = "http://localhost:8083/applications"

            var form = document.querySelector('form');
            form.addEventListener('submit', function(event) {
                event.preventDefault();

                var formData = new FormData(form);
                var entries = formData.entries();
                var jsonObject = {};

                for (var input of entries) {
                    var key = input[0];
                    var value = input[1];

                    if (value === "on") { value = true; }
                    
                    jsonObject[key] = value;
                }

                var jsonData = JSON.stringify(jsonObject);

                console.log(jsonData);

                var xhr = new XMLHttpRequest();
                xhr.open("POST", url, true);
                xhr.setRequestHeader("Content-Type", "application/json");

                xhr.onreadystatechange = function () {
                    if (xhr.readyState === 4) {
                        if (xhr.status === 200) {
                            var response = JSON.parse(xhr.responseText);
                            console.log("Application created with ID: " + response.id);
                            for (var i = 0; i < response.quotations.length; i++) {
                                var quotation = response.quotations[i];
                                console.log("Price: " + quotation.price);
                                console.log("|===================================|\n\n");
                            }
                        } else {
                            console.log("Failed to create application: " + xhr.status);
                        }
                    }
                }
                xhr.send(jsonData);
            });
        </script>
    </body>
</html>